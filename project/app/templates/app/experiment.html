{% extends 'base.html' %}
{% block content %}

<div class="text-center d-grid">
<button id="start-button" class="btn btn-primary d-block mx-auto btn-lg"> Start</button>
</div>
<div id = 'container' class='hidden'> 
{% for item in form %}
<img
  src="{{ item.img.url }}"
  name="{{item.name}}"
  class="product-image"
  alt="image"
/>
{% endfor %}
<div class="form">
  <form method="POST">
    {% csrf_token %}

    <input id="data" name="data" class="hidden" />

    <input id="labels" name="labels" class="hidden" />

    <div class="text-center">
      <button id="submit" class="btn btn-primary d-block mx-auto btn-lg hidden">
        Results
      </button>
    </div>
  </form>

  <div class="text-center">
    <input id="answer" type="text" />
  </div>
</div>

<div class="text-center d-grid">
  <button id="next-button" class="btn btn-primary d-block mx-auto btn-lg">
    Next
  </button>
</div>
</div>


{% endblock %} {% block scripts %}
<script>
  const startButton = document.getElementById('start-button');
  const container = document.getElementById('container');
  const images = document.querySelectorAll(".product-image");
  const nextButton = document.getElementById("next-button");
  const subbutton = document.getElementById("submit");
  const data = document.getElementById("data");
  const labels_data = document.getElementById("labels");
  const ans = document.getElementById("answer");
  let currentIndex = 0;

  let labels = "";
  let ansver = "";
  let labels_dataxx = "";




  function showImage(index) {
    images.forEach((image) => (image.style.display = "none"));
    images[index].style.display = "block";
    labels_dataxx += "-" + images[currentIndex].name;
    setTimeout(() => {
      images[index].style.display = "none";
    }, 1000);
  }

  function nextImage() {
    if (currentIndex < images.length) {
      if (currentIndex === images.length - 1) {
        nextButton.classList.add("hidden");
        ans.classList.add("hidden");
        subbutton.classList.remove("hidden");
      } else {
        console.log("");
      }

      ansver = ans.value;

      if (ansver.length > 0) {
        currentIndex++;
        labels += "-" + ansver;
        labels_data.value = labels_dataxx;
        ans.value = "";
        data.value = labels;

        ans.focus();
        showImage(currentIndex);
      } 
    }
  }

  function handleButtonClick() {
    container.classList.remove("hidden");
    startButton.classList.add("hidden");
    
    nextButton.addEventListener("click", nextImage);
    answer.addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        console.log('dzia≈Ça');
        nextButton.click();
      }
    });
    showImage(currentIndex);
  }

  startButton.addEventListener('click', handleButtonClick);
</script>
{% endblock %}
